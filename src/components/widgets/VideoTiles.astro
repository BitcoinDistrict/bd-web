---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import type { VideoTiles as Props } from '~/types';

// Function to convert regular YouTube URLs to privacy-enhanced version
const getPrivacyEnhancedUrl = (url: string): string => {
  return url.replace('youtube.com/embed', 'youtube-nocookie.com/embed');
};

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline = await Astro.slots.render('tagline'),
  videos = [],
  columns = 2,

  id,
  isDark = false,
  classes = {},
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass={`max-w-7xl ${classes?.container ?? ''}`} bg={bg}>
  <Headline title={title} subtitle={subtitle} tagline={tagline} classes={classes?.headline as Record<string, string>} />
  
  <div class={`grid gap-8 md:gap-12 ${
    columns === 1 ? 'grid-cols-1' :
    columns === 2 ? 'grid-cols-1 md:grid-cols-2' :
    columns === 3 ? 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3' :
    columns === 4 ? 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4' :
    'grid-cols-1 md:grid-cols-2'
  }`}>
    {videos.map((video) => (
      <div class="text-center">
        <h3 class={`font-bold mb-3 ${
          columns >= 3 ? 'text-xl' : 'text-2xl'
        }`}>
          {video.title}
        </h3>
        {video.author && (
          <p class={`text-muted mb-4 ${
            columns >= 3 ? 'text-sm' : 'text-base'
          }`}>
            by {video.author}
          </p>
        )}
        <div class="aspect-video">
          <iframe 
            width="100%" 
            height="100%" 
            src={getPrivacyEnhancedUrl(video.embedUrl)}
            title={video.title}
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen
            class="rounded-lg shadow-lg"
          ></iframe>
        </div>
        {video.description && (
          <p class={`text-muted mt-3 ${
            columns >= 3 ? 'text-sm' : 'text-base'
          }`}>
            {video.description}
          </p>
        )}
      </div>
    ))}
  </div>
</WidgetWrapper>